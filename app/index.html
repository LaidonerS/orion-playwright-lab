<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Orion Test Lab â€“ Demo App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <script defer src="app.js"></script>
</head>
<body>
  <header class="top-bar">
    <div class="logo">Orion<span>Lab</span></div>
    <nav class="nav">
      <a href="#dashboard" class="nav-link">Dashboard</a>
      <a href="#products" class="nav-link">Products</a>
      <a href="#contact" class="nav-link">Contact</a>
    </nav>
  </header>

  <main>
    <!-- Dashboard section -->
    <section id="dashboard" class="section">
      <h1 data-testid="page-title">QA Automation Playground</h1>
      <p class="subtitle">
        A tiny web app designed for practising Playwright tests in real-life flows.
      </p>

      <div class="kpi-grid">
        <div class="card" data-testid="kpi-users">
          <h2>Active Users</h2>
          <p class="kpi-value" id="kpi-users-count">128</p>
        </div>
        <div class="card" data-testid="kpi-coverage">
          <h2>Test Coverage</h2>
          <p class="kpi-value" id="kpi-coverage-value">82%</p>
        </div>
        <div class="card" data-testid="kpi-builds">
          <h2>Last Build</h2>
          <p class="kpi-value" id="kpi-last-build">passing</p>
        </div>
      </div>
    </section>

    <!-- Products section -->
    <section id="products" class="section">
      <h2>Featured Test Scenarios</h2>
      <div class="card-grid">
        <article class="card product-card" data-testid="scenario-login">
          <h3>Login Flow</h3>
          <p>Validate happy path, error states, and inline validation.</p>
          <button class="btn primary" data-open-login>Open Login Modal</button>
        </article>

        <article class="card product-card" data-testid="scenario-filters">
          <h3>Filtering & Search</h3>
          <p>Test filtering, sorting, and empty state behavior.</p>
          <button class="btn" disabled data-testid="coming-soon-btn">
            Coming soon
          </button>
        </article>

        <article class="card product-card" data-testid="scenario-contact">
          <h3>Contact Form</h3>
          <p>Validate client-side validation and success messages.</p>
          <a href="#contact" class="btn outline">Jump to form</a>
        </article>
      </div>
    </section>

    <!-- Activity + Session log section -->
    <section id="activity" aria-labelledby="activity-heading" class="section">
      <div class="card" data-testid="scenario-activity">
        <h2 id="activity-heading">Recent Activity Feed</h2>
        <p class="card-subtitle">
          Demo of async UI, fake API and session activity log.
        </p>

        <button
          type="button"
          data-testid="load-activity"
        >
          Load Recent Activity
        </button>

        <p
          class="status"
          data-testid="activity-status"
          aria-live="polite"
        >
          No activity loaded yet.
        </p>

        <ul
          data-testid="activity-list"
          aria-label="Recent activity"
        >
          <!-- items will be injected here -->
        </ul>

        <hr />

        <!-- Session activity log -->
        <h3>Session Activity</h3>
        <p class="card-subtitle">
          Actions you take in this demo are logged here.
        </p>

        <ul
          data-testid="session-activity-list"
          aria-label="Session activity"
        >
          <!-- session items injected here -->
        </ul>
      </div>
    </section>

    <!-- Contact / feedback form -->
    <section id="contact" class="section">
      <h2>Contact / Feedback</h2>
      <p>Use this form to simulate a typical user feedback flow.</p>

      <form id="contact-form" novalidate>
        <div class="form-row">
          <label for="name">Name</label>
          <input id="name" name="name" type="text" required
                 placeholder="Your name" />
          <span class="error-message" data-error-for="name"></span>
        </div>

        <div class="form-row">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required
                 placeholder="you@example.com" />
          <span class="error-message" data-error-for="email"></span>
        </div>

        <div class="form-row">
          <label for="topic">Topic</label>
          <select id="topic" name="topic" required>
            <option value="">Select a topic</option>
            <option value="bug">Bug report</option>
            <option value="idea">Feature idea</option>
            <option value="other">Other</option>
          </select>
          <span class="error-message" data-error-for="topic"></span>
        </div>

        <div class="form-row">
          <label for="message">Message</label>
          <textarea id="message" name="message" rows="4" required
                    placeholder="Tell us what you want to test here..."></textarea>
          <span class="error-message" data-error-for="message"></span>
        </div>

        <button type="submit" class="btn primary" data-testid="submit-contact">
          Send feedback
        </button>

        <p class="form-success" data-testid="contact-success" hidden>
          âœ… Thank you â€“ your feedback was captured (fake, but useful for tests).
        </p>
      </form>
    </section>
  </main>

  <!-- Login modal -->
  <div class="modal-backdrop" id="login-modal" aria-hidden="true">
    <div class="modal">
      <h2>Demo Login</h2>
      <p class="modal-subtitle">Use this to simulate login test scenarios.</p>

      <form id="login-form" novalidate data-testid="login-form">
        <div class="form-row">
          <label for="login-email">Email</label>
          <input id="login-email" name="login-email" type="email" required
                 placeholder="qa@example.com" data-testid="login-email" />
          <span class="error-message" data-error-for="login-email"></span>
        </div>

        <div class="form-row">
          <label for="login-password">Password</label>
          <input id="login-password" name="login-password" type="password" required
                 minlength="4"
                 placeholder="â€¢â€¢â€¢â€¢" data-testid="login-password" />
          <span class="error-message" data-error-for="login-password"></span>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn" data-close-login>Cancel</button>
          <button type="submit" class="btn primary" data-testid="login-submit">
            Login
          </button>
        </div>

        <p class="form-success" data-testid="login-success" hidden>
          ðŸŽ‰ Logged in as <span id="login-user-label">qa@example.com</span>
        </p>
      </form>
    </div>
  </div>

  <!-- Session activity log helpers -->
  <script>
    // --- Session activity log helpers ---

    window.orionSessionActivityLog = window.orionSessionActivityLog || [];

    function renderSessionActivity() {
      const listEl = document.querySelector('[data-testid="session-activity-list"]');
      if (!listEl) return;

      listEl.innerHTML = "";

      if (!window.orionSessionActivityLog || window.orionSessionActivityLog.length === 0) {
        const li = document.createElement("li");
        li.textContent = "No interactions yet.";
        listEl.appendChild(li);
        return;
      }

      window.orionSessionActivityLog.forEach((item) => {
        const li = document.createElement("li");
        li.setAttribute("data-testid", "session-activity-item");
        li.setAttribute("tabindex", "0");
        li.textContent = `${item.when} â€¢ ${item.message}`;
        listEl.appendChild(li);
      });
    }

    function addSessionActivity(message) {
      const entry = {
        when: new Date().toLocaleTimeString(),
        message,
      };
      // newest first
      window.orionSessionActivityLog.unshift(entry);
      renderSessionActivity();
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderSessionActivity();
    });
  </script>

  <!-- Remote activity feed (fake API) -->
  <script>
    async function loadActivity() {
      const statusEl = document.querySelector('[data-testid="activity-status"]');
      const listEl = document.querySelector('[data-testid="activity-list"]');

      if (!statusEl || !listEl) return;

      statusEl.textContent = "Loadingâ€¦";
      listEl.innerHTML = "";

      try {
        const response = await fetch("/api/activity");
        if (!response.ok) {
          throw new Error("Network error");
        }

        const data = await response.json();

        if (!Array.isArray(data) || data.length === 0) {
          statusEl.textContent = "No recent activity.";
          return;
        }

        statusEl.textContent = `Loaded ${data.length} event${data.length > 1 ? "s" : ""}.`;
        data.forEach((item) => {
          const li = document.createElement("li");
          li.setAttribute("data-testid", "activity-item");
          li.setAttribute("tabindex", "0");
          li.textContent = `${item.when} â€¢ ${item.message}`;
          listEl.appendChild(li);
        });
      } catch (e) {
        statusEl.textContent = "Could not load activity. Please try again.";
      }
    }

    const loadBtn = document.querySelector('[data-testid="load-activity"]');
    if (loadBtn) {
      loadBtn.addEventListener("click", () => {
        loadActivity();
      });
    }
  </script>

  <!-- Hook login + contact form into session activity -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Contact form: log when submission is successful
      const contactForm = document.getElementById("contact-form");
      if (contactForm) {
        contactForm.addEventListener("submit", () => {
          // Allow app.js to run validation & toggle success message first
          setTimeout(() => {
            const successEl = document.querySelector('[data-testid="contact-success"]');
            if (successEl && !successEl.hasAttribute("hidden")) {
              const topicSelect = document.getElementById("topic");
              const topicValue = topicSelect ? topicSelect.value || "unknown" : "unknown";
              addSessionActivity(`Contact form submitted (${topicValue})`);
            }
          }, 150);
        });
      }

      // Login form: log when login is successful
      const loginForm = document.getElementById("login-form");
      if (loginForm) {
        loginForm.addEventListener("submit", () => {
          setTimeout(() => {
            const successEl = document.querySelector('[data-testid="login-success"]');
            if (successEl && !successEl.hasAttribute("hidden")) {
              const emailInput = document.getElementById("login-email");
              const email = emailInput ? emailInput.value.trim() : "unknown user";
              addSessionActivity(`Login success for ${email}`);
            }
          }, 150);
        });
      }
    });
  </script>
</body>
</html>
